<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>‡∏£‡πâ‡∏≤‡∏ô‡∏î‡∏≠‡∏Å‡πÑ‡∏°‡πâ‡∏™‡∏≤‡∏ò‡∏∏</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
    
    <script>
        // =========================================================================
        // üî¥üî¥üî¥ ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö (‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏°‡∏≤‡∏Å) üî¥üî¥üî¥
        // =========================================================================
        
        // 1. ‡∏ô‡∏≥ URL ‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£ Deploy Web App (Google Apps Script) ‡∏°‡∏≤‡∏ß‡∏≤‡∏á‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢ '' ‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡∏ô‡∏µ‡πâ
        const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbynPOvczjtfSJosLTMDrkWpbxFtTrj0RiJYR28W928kOP3WGst9vNGBLibD3RbyBUZZ/exec'; 

        // =========================================================================
        
        const IMAGE_LINKS = {
            lotus:    'https://lh3.googleusercontent.com/d/1yTbEv2lg8FU-_4jaXgV8yqpVt_71laKG',
            orchid:   'https://lh3.googleusercontent.com/d/1J1Eq279p2AO2nSI6MH4TZyXgkepQ6JkM',
            marigold: 'https://lh3.googleusercontent.com/d/1twPglNYRHVs9QxB7kS7UO6VnU6okxpq3',
            qrcode:   'https://lh3.googleusercontent.com/d/1g1z-sT8BDFYhbxph8uim7fzgtko42Pwd' 
        };

        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'sathu-red': { 50: '#fdf2f2', 100: '#fde8e8', 500: '#9F2A2F', 600: '#8E1F24', 900: '#4a0d10' },
                        'sathu-gold': { 400: '#EBCB8B', 500: '#D4AF37', 600: '#B48E26' },
                    },
                    fontFamily: { sans: ['Sarabun', 'sans-serif'] }
                }
            }
        }
    </script>
    <style>
        body { background-color: #F8F9FA; -webkit-tap-highlight-color: transparent; }
        .app-container { max-width: 420px; margin: 0 auto; background-color: #FDFBF7; min-height: 100vh; position: relative; box-shadow: 0 0 20px rgba(0,0,0,0.1); }
        .brand-header { background: linear-gradient(135deg, #9F2A2F 0%, #751a1e 100%); color: #EBCB8B; border-bottom: 2px solid #D4AF37; }
        .product-card.active { border-color: #9F2A2F; background-color: #fffbfb; }
        .loading-spinner { border: 3px solid #f3f3f3; border-top: 3px solid #9F2A2F; border-radius: 50%; width: 20px; height: 20px; animation: spin 1s linear infinite; }
        ::-webkit-scrollbar { width: 0px; background: transparent; }
    </style>
</head>
<body>

    <div class="app-container flex flex-col">
        <!-- Header -->
        <header class="brand-header sticky top-0 z-20 px-5 py-4 flex justify-between items-center shadow-md">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 bg-sathu-gold-400 rounded-full flex items-center justify-center text-sathu-red-900 font-bold shadow-inner border-2 border-sathu-red-900">
                    <span class="material-icons-round text-xl">spa</span>
                </div>
                <div>
                    <h1 class="font-bold text-[#EBCB8B] text-xl leading-none tracking-wide drop-shadow-sm">‡∏£‡πâ‡∏≤‡∏ô‡∏î‡∏≠‡∏Å‡πÑ‡∏°‡πâ‡∏™‡∏≤‡∏ò‡∏∏</h1>
                    <p class="text-[10px] text-white/80 font-light mt-0.5">‡∏Å‡∏≥‡∏•‡∏∞ 10 ‡∏ö‡∏≤‡∏ó ‡∏™‡πà‡∏á‡∏ö‡∏∏‡∏ç‡∏ñ‡∏∂‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏ö‡πâ‡∏≤‡∏ô</p>
                </div>
            </div>
            <div class="bg-white/10 backdrop-blur-sm border border-white/20 text-[#EBCB8B] px-2 py-1 rounded-lg text-[10px] font-bold flex items-center gap-1.5">
                <span class="w-2 h-2 bg-green-400 rounded-full animate-pulse shadow-[0_0_5px_#4ade80]"></span> ‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡∏±‡∏ö‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå
            </div>
        </header>

        <!-- Content -->
        <main class="flex-1 p-4 space-y-6 pb-32">
            <!-- Step 1: Product List -->
            <section>
                <div class="flex items-center gap-2 mb-3">
                    <span class="bg-sathu-red-100 text-sathu-red-600 w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold border border-sathu-red-200">1</span>
                    <h2 class="font-bold text-gray-800">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (‡∏ä‡∏¥‡πâ‡∏ô‡∏•‡∏∞ 10.-)</h2>
                </div>
                <div class="space-y-3" id="product-list"></div>
            </section>

            <hr class="border-dashed border-gray-200">

            <!-- Step 2: Date & Location -->
            <section>
                <div class="flex items-center gap-2 mb-3">
                    <span class="bg-sathu-red-100 text-sathu-red-600 w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold border border-sathu-red-200">2</span>
                    <h2 class="font-bold text-gray-800">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏±‡∏î‡∏™‡πà‡∏á</h2>
                </div>
                <div class="bg-white p-4 rounded-xl border border-gray-200 shadow-sm space-y-4">
                    <div>
                        <label class="text-xs font-bold text-gray-500 mb-1 block">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ô‡∏±‡∏î‡∏£‡∏±‡∏ö</label>
                        <input type="date" id="order-date" class="w-full bg-gray-50 border border-gray-200 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-1 focus:ring-sathu-red-500 text-gray-700">
                    </div>
                    <div>
                        <label class="text-xs font-bold text-gray-500 mb-1 block">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏≠‡∏ö‡∏™‡πà‡∏á</label>
                        <div class="grid grid-cols-2 gap-2">
                            <label class="cursor-pointer">
                                <input type="radio" name="timeslot" value="‡∏£‡∏≠‡∏ö‡πÄ‡∏ä‡πâ‡∏≤ (07:00-09:00)" class="peer sr-only" checked>
                                <div class="text-center py-2 border rounded-lg peer-checked:bg-sathu-red-500 peer-checked:text-white text-xs font-medium transition-all">‚òÄÔ∏è ‡∏£‡∏≠‡∏ö‡πÄ‡∏ä‡πâ‡∏≤ (07:00-09:00)</div>
                            </label>
                            <label class="cursor-pointer">
                                <input type="radio" name="timeslot" value="‡∏£‡∏≠‡∏ö‡πÄ‡∏¢‡πá‡∏ô (16:00-18:00)" class="peer sr-only">
                                <div class="text-center py-2 border rounded-lg peer-checked:bg-sathu-red-500 peer-checked:text-white text-xs font-medium transition-all">üåô ‡∏£‡∏≠‡∏ö‡πÄ‡∏¢‡πá‡∏ô (16:00-18:00)</div>
                            </label>
                        </div>
                    </div>
                    <div>
                        <button onclick="getLocation()" id="gps-btn" class="w-full py-3 bg-blue-50 text-blue-600 rounded-lg border border-dashed border-blue-300 text-xs font-bold flex items-center justify-center gap-2 hover:bg-blue-100 transition-colors">
                            <span class="material-icons-round text-sm">near_me</span> ‡πÅ‡∏ä‡∏£‡πå‡∏û‡∏¥‡∏Å‡∏±‡∏î GPS (‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô)
                        </button>
                        <p id="gps-status" class="text-[10px] text-green-600 mt-2 text-center hidden">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏û‡∏¥‡∏Å‡∏±‡∏î‡πÅ‡∏•‡πâ‡∏ß: <span id="latlong">...</span></p>
                    </div>
                    <div class="grid grid-cols-2 gap-2 pt-2 border-t border-gray-100">
                        <input type="text" id="customer-name" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô" class="bg-gray-50 border border-gray-200 rounded-lg px-3 py-2 text-sm">
                        <input type="tel" id="customer-phone" placeholder="‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£" class="bg-gray-50 border border-gray-200 rounded-lg px-3 py-2 text-sm">
                    </div>
                </div>
            </section>

            <!-- Step 3: Payment -->
            <section>
                <div class="flex items-center gap-2 mb-3">
                    <span class="bg-sathu-red-100 text-sathu-red-600 w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold border border-sathu-red-200">3</span>
                    <h2 class="font-bold text-gray-800">‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</h2>
                </div>
                <div class="bg-white p-4 rounded-xl border border-gray-200 shadow-sm text-center">
                    <p class="text-xs text-gray-500 mb-1">‡∏¢‡∏≠‡∏î‡∏ä‡∏≥‡∏£‡∏∞‡∏£‡∏ß‡∏°</p>
                    <p class="text-4xl font-bold text-sathu-red-600 mb-4 tracking-tight" id="display-total">‡∏ø0</p>
                    
                    <div class="bg-white p-2 rounded-lg inline-block border border-gray-200 mb-3 overflow-hidden">
                        <!-- ‡∏™‡πà‡∏ß‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏• QR Code -->
                        <img id="qr-image" src="https://placehold.co/150x150?text=Loading..." class="w-32 h-32 object-contain mix-blend-multiply" referrerpolicy="no-referrer">
                    </div>
                    
                    <!-- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏±‡∏ç‡∏ä‡∏µ -->
                    <div class="text-xs text-gray-600 space-y-1">
                        <p class="font-bold text-gray-800 text-sm">‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏û‡∏¢‡πå: 084-793-6665</p>
                        <p>‡∏ß‡∏¥‡∏ó‡∏¢‡πå‡∏™‡∏£‡∏±‡∏ä ‡∏™‡∏∏‡∏à‡∏≤‡∏£‡∏µ (‡∏£‡πâ‡∏≤‡∏ô‡∏î‡∏≠‡∏Å‡πÑ‡∏°‡πâ‡∏™‡∏≤‡∏ò‡∏∏)</p>
                    </div>

                    <label class="mt-4 flex items-center justify-center gap-2 w-full py-2.5 bg-gray-50 text-gray-600 rounded-lg border border-dashed border-gray-300 cursor-pointer hover:bg-gray-100 transition-colors">
                        <span class="material-icons-round text-lg">cloud_upload</span>
                        <span class="text-xs font-bold" id="slip-text">‡πÅ‡∏ô‡∏ö‡∏™‡∏•‡∏¥‡∏õ‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</span>
                        <input type="file" id="slip-file" class="hidden" accept="image/*" onchange="uploadSlip(this)">
                    </label>
                </div>
            </section>
        </main>

        <!-- Bottom Bar -->
        <div class="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-100 p-4 shadow-lg z-30 max-w-[420px] mx-auto">
            <div class="flex justify-between items-center mb-2">
                <div class="text-xs text-gray-500"><span id="total-items-count">0</span> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</div>
                <div class="text-xl font-bold text-sathu-red-600" id="bottom-total">‡∏ø0</div>
            </div>
            <button onclick="confirmOrder()" id="confirm-btn" class="w-full bg-sathu-red-600 text-white py-3 rounded-full font-bold shadow-lg shadow-sathu-red-600/30 disabled:opacity-50 disabled:cursor-not-allowed">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</button>
        </div>

        <!-- Success Modal -->
        <div id="success-modal" class="fixed inset-0 z-50 flex items-center justify-center pointer-events-none opacity-0 transition-opacity duration-300">
            <div class="absolute inset-0 bg-black/50 backdrop-blur-sm" onclick="closeModal()"></div>
            <div class="bg-white w-[90%] max-w-sm rounded-2xl p-6 shadow-2xl transform scale-95 transition-transform duration-300 relative z-10" id="modal-content">
                <div class="text-center">
                    <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4 text-green-500"><span class="material-icons-round text-3xl">check_circle</span></div>
                    <h2 class="text-xl font-bold text-gray-800 mb-1">‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!</h2>
                    <p class="text-sm text-gray-500 mb-4">‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏£‡πà‡∏ß‡∏°‡∏ö‡∏∏‡∏ç‡∏Å‡∏±‡∏ö‡πÄ‡∏£‡∏≤‡∏Ñ‡∏£‡∏±‡∏ö</p>
                    <div class="bg-gray-50 p-3 rounded-lg text-left text-sm text-gray-600 mb-4" id="order-summary-text"></div>
                    <button onclick="closeModal()" class="w-full bg-gray-800 text-white py-2.5 rounded-xl font-bold">‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á</button>
                </div>
            </div>
        </div>
        
        <!-- Loading -->
        <div id="loading-overlay" class="fixed inset-0 z-[60] flex items-center justify-center bg-white/80 hidden"><div class="loading-spinner w-10 h-10 border-4"></div></div>
    </div>

    <script>
        const products = [
            { id: 'lotus', name: '‡∏ä‡πà‡∏≠‡∏î‡∏≠‡∏Å‡∏ö‡∏±‡∏ß‡∏Ç‡∏≤‡∏ß', price: 10, img: IMAGE_LINKS.lotus },
            { id: 'orchid', name: '‡∏ä‡πà‡∏≠‡∏Å‡∏•‡πâ‡∏ß‡∏¢‡πÑ‡∏°‡πâ‡∏°‡πà‡∏ß‡∏á', price: 10, img: IMAGE_LINKS.orchid },
            { id: 'marigold', name: '‡∏ä‡πà‡∏≠‡∏î‡∏≤‡∏ß‡πÄ‡∏£‡∏∑‡∏≠‡∏á', price: 10, img: IMAGE_LINKS.marigold }
        ];

        // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ QR Code
        if (IMAGE_LINKS.qrcode && IMAGE_LINKS.qrcode.trim() !== '') {
            document.getElementById('qr-image').src = IMAGE_LINKS.qrcode;
        } else {
            document.getElementById('qr-image').src = 'https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=PromptPay-0847936665';
        }

        let cart = {}; 
        let userLocation = '';

        function initApp() {
            const container = document.getElementById('product-list');
            products.forEach(p => {
                cart[p.id] = 0;
                const html = `
                <div class="product-card bg-white border border-gray-200 rounded-xl p-3 flex gap-3 items-center transition-all shadow-sm" id="card-${p.id}">
                    <div class="w-20 h-20 rounded-lg overflow-hidden bg-gray-100 flex-shrink-0 relative border border-gray-100">
                        <img src="${p.img}" class="w-full h-full object-cover" referrerpolicy="no-referrer" onerror="this.src='https://placehold.co/300?text=Error';">
                    </div>
                    <div class="flex-1 min-w-0">
                        <h3 class="font-bold text-gray-800 text-sm truncate">${p.name}</h3>
                        <p class="text-sathu-red-600 font-bold">‡∏ø${p.price} <span class="text-xs font-normal text-gray-400">/ ‡∏Å‡∏≥</span></p>
                    </div>
                    <div class="flex items-center gap-2 bg-gray-50 rounded-lg p-1 border border-gray-100">
                        <button onclick="updateQty('${p.id}', -1)" class="w-8 h-8 flex items-center justify-center bg-white rounded shadow-sm text-gray-600 active:scale-90 transition-transform disabled:opacity-30" id="btn-minus-${p.id}" disabled><span class="material-icons-round text-sm">remove</span></button>
                        <span class="w-6 text-center font-bold text-gray-800 text-sm" id="qty-${p.id}">0</span>
                        <button onclick="updateQty('${p.id}', 1)" class="w-8 h-8 flex items-center justify-center bg-sathu-red-500 text-white rounded shadow-sm shadow-sathu-red-500/30 active:scale-90 transition-transform"><span class="material-icons-round text-sm">add</span></button>
                    </div>
                </div>`;
                container.insertAdjacentHTML('beforeend', html);
            });
            calculateTotal();
        }

        function updateQty(id, change) {
            const current = cart[id];
            const newVal = current + change;
            if (newVal >= 0) {
                cart[id] = newVal;
                document.getElementById(`qty-${id}`).innerText = newVal;
                document.getElementById(`btn-minus-${id}`).disabled = (newVal === 0);
                const card = document.getElementById(`card-${id}`);
                if (newVal > 0) card.classList.add('active'); else card.classList.remove('active');
                calculateTotal();
            }
        }

        function calculateTotal() {
            let total = 0;
            let count = 0;
            products.forEach(p => { total += cart[p.id] * p.price; count += cart[p.id]; });
            document.getElementById('display-total').innerText = `‡∏ø${total}`;
            document.getElementById('bottom-total').innerText = `‡∏ø${total}`;
            document.getElementById('total-items-count').innerText = count;
            const confirmBtn = document.getElementById('confirm-btn');
            if (count === 0) {
                confirmBtn.disabled = true; confirmBtn.classList.add('opacity-50', 'bg-gray-400'); confirmBtn.classList.remove('bg-sathu-red-600');
            } else {
                confirmBtn.disabled = false; confirmBtn.classList.remove('opacity-50', 'bg-gray-400'); confirmBtn.classList.add('bg-sathu-red-600');
            }
        }

        function getLocation() {
            const btn = document.getElementById('gps-btn');
            const status = document.getElementById('gps-status');
            btn.innerHTML = '<div class="loading-spinner"></div> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏´‡∏≤‡∏û‡∏¥‡∏Å‡∏±‡∏î...';
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (pos) => {
                        userLocation = `${pos.coords.latitude.toFixed(5)}, ${pos.coords.longitude.toFixed(5)}`;
                        btn.classList.replace('bg-blue-50', 'bg-green-500'); btn.classList.replace('text-blue-600', 'text-white'); btn.classList.remove('border-dashed');
                        btn.innerHTML = '<span class="material-icons-round text-sm">check</span> ‡∏£‡∏∞‡∏ö‡∏∏‡∏û‡∏¥‡∏Å‡∏±‡∏î‡πÅ‡∏•‡πâ‡∏ß';
                        status.classList.remove('hidden'); document.getElementById('latlong').innerText = userLocation;
                    },
                    () => {
                        userLocation = '17.41500, 102.78600 (‡∏à‡∏≥‡∏•‡∏≠‡∏á)';
                        alert('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏£‡∏∞‡∏ö‡∏∏‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏à‡∏£‡∏¥‡∏á‡πÑ‡∏î‡πâ ‡πÉ‡∏ä‡πâ‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏à‡∏≥‡∏•‡∏≠‡∏á‡πÅ‡∏ó‡∏ô');
                        status.classList.remove('hidden'); document.getElementById('latlong').innerText = userLocation;
                        btn.innerHTML = '‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á';
                    }
                );
            }
        }

        function uploadSlip(input) {
            const text = document.getElementById('slip-text');
            if (input.files && input.files[0]) {
                text.innerText = '‡πÅ‡∏ô‡∏ö‡πÅ‡∏•‡πâ‡∏ß: ' + input.files[0].name.substring(0, 10) + '...';
                text.parentElement.classList.replace('bg-gray-50', 'bg-green-50'); text.parentElement.classList.replace('text-gray-600', 'text-green-600');
                text.parentElement.classList.replace('border-gray-300', 'border-green-300'); text.parentElement.classList.remove('border-dashed');
            }
        }

        function confirmOrder() {
            if (document.getElementById('bottom-total').innerText === '‡∏ø0') return alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏ä‡∏¥‡πâ‡∏ô');
            
            // ‡πÄ‡∏ä‡πá‡∏Ñ URL ‡∏Å‡πà‡∏≠‡∏ô
            if (!WEB_APP_URL || WEB_APP_URL.trim() === '') {
                return alert('‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà URL ‡∏Ç‡∏≠‡∏á Web App ‡πÉ‡∏ô‡πÇ‡∏Ñ‡πâ‡∏î‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ó‡∏µ‡πà 13 ‡∏Å‡πà‡∏≠‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö (‡∏î‡∏π‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏≥‡πÉ‡∏ô‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠)');
            }

            const date = document.getElementById('order-date').value;
            const name = document.getElementById('customer-name').value;
            const phone = document.getElementById('customer-phone').value;
            const slipFile = document.getElementById('slip-file').files[0];
            
            if (!date || !name || !phone) return alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô');
            if (!userLocation) return alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏î‡πÅ‡∏ä‡∏£‡πå‡∏û‡∏¥‡∏Å‡∏±‡∏î GPS');

            document.getElementById('loading-overlay').classList.remove('hidden');

            let itemSummary = [];
            products.forEach(p => { if (cart[p.id] > 0) itemSummary.push(`${p.name} x${cart[p.id]}`); });

            const orderData = {
                items: itemSummary.join(', '), totalPrice: document.getElementById('bottom-total').innerText,
                date: date, timeslot: document.querySelector('input[name="timeslot"]:checked').value,
                location: userLocation, name: name, phone: phone, slipImage: null
            };

            if (slipFile) {
                const reader = new FileReader();
                reader.onload = function(e) { orderData.slipImage = e.target.result; sendToGoogle(orderData); };
                reader.readAsDataURL(slipFile);
            } else { sendToGoogle(orderData); }
        }

        function sendToGoogle(data) {
            // ‡πÉ‡∏ä‡πâ fetch ‡πÅ‡∏ó‡∏ô google.script.run
            fetch(WEB_APP_URL, {
                method: 'POST',
                redirect: 'follow', // ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏°‡∏≤‡∏Å ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Apps Script
                headers: {
                    "Content-Type": "text/plain;charset=utf-8", // ‡πÉ‡∏ä‡πâ text/plain ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á CORS
                },
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(responseData => {
                if (responseData.success) {
                    onSuccess();
                } else {
                    alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + responseData.message);
                    document.getElementById('loading-overlay').classList.add('hidden');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà');
                document.getElementById('loading-overlay').classList.add('hidden');
            });
        }

        function onSuccess() {
            document.getElementById('loading-overlay').classList.add('hidden');
            let summaryHtml = '<ul class="list-disc pl-4 space-y-1">';
            products.forEach(p => { if (cart[p.id] > 0) summaryHtml += `<li>${p.name} <b>x${cart[p.id]}</b></li>`; });
            summaryHtml += '</ul>';
            document.getElementById('order-summary-text').innerHTML = summaryHtml;
            document.getElementById('success-modal').classList.remove('opacity-0', 'pointer-events-none');
            document.getElementById('modal-content').classList.remove('scale-95');
        }

        function closeModal() { window.location.reload(); }

        initApp();
    </script>
</body>
</html>