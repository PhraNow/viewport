<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>‡∏£‡πâ‡∏≤‡∏ô‡∏î‡∏≠‡∏Å‡πÑ‡∏°‡πâ‡∏™‡∏≤‡∏ò‡∏∏ - ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏ö‡∏∏‡∏ç</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
    
    <script>
        // =========================================================================
        // üî¥üî¥üî¥ ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö üî¥üî¥üî¥
        // =========================================================================
        
        // 1. URL Web App (‡πÉ‡∏ä‡πâ‡∏≠‡∏±‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡πÉ‡∏´‡πâ‡∏°‡∏≤)
        const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbzN8p1bt_HUHaY1hTjaWypxekf5xos_pWXNi6yYOcQYoNW5vp16f4ln9xBvWJrroPWI/exec'; 

        // 2. ‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û (‡πÉ‡∏™‡πà‡∏•‡∏¥‡∏á‡∏Å‡πå Drive ‡∏õ‡∏Å‡∏ï‡∏¥‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢ ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏ö‡∏ö‡∏ó‡∏µ‡πà‡πÇ‡∏ä‡∏ß‡πå‡πÑ‡∏î‡πâ‡πÉ‡∏´‡πâ‡πÄ‡∏≠‡∏á)
        const IMAGE_LINKS = {
            lotus:    'https://drive.google.com/file/d/1yTbEv2lg8FU-_4jaXgV8yqpVt_71laKG/view?usp=sharing',
            orchid:   'https://drive.google.com/file/d/1J1Eq279p2AO2nSI6MH4TZyXgkepQ6JkM/view?usp=sharing',
            marigold: 'https://drive.google.com/file/d/1It1hrUdx69s_U3WPMHMB8IsLGdfJN8H0/view?usp=sharing', // ‡∏≠‡∏±‡∏ô‡πÉ‡∏´‡∏°‡πà
            qrcode:   'https://drive.google.com/file/d/1g1z-sT8BDFYhbxph8uim7fzgtko42Pwd/view?usp=sharing' 
        };

        const BANK_INFO = {
            name: "‡∏ß‡∏¥‡∏ó‡∏¢‡πå‡∏™‡∏£‡∏±‡∏ä ‡∏™‡∏∏‡∏à‡∏≤‡∏£‡∏µ (‡∏£‡πâ‡∏≤‡∏ô‡∏î‡∏≠‡∏Å‡πÑ‡∏°‡πâ‡∏™‡∏≤‡∏ò‡∏∏)",
            number: "084-793-6665",
            raw_number: "0847936665"
        };

        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'sathu-red': { 50: '#fff1f2', 100: '#ffe4e6', 500: '#9F2A2F', 600: '#8E1F24', 900: '#4c0519' },
                        'sathu-gold': { 400: '#fbbf24', 500: '#d97706', 600: '#b45309' },
                    },
                    fontFamily: { sans: ['Prompt', 'sans-serif'] }
                }
            }
        }
    </script>
    <style>
        body { 
            background-color: #fdfbf7; 
            background-image: radial-gradient(#e5e7eb 1px, transparent 1px);
            background-size: 20px 20px;
            -webkit-tap-highlight-color: transparent; 
        }
        .app-container { max-width: 420px; margin: 0 auto; background-color: rgba(255,255,255,0.95); min-height: 100vh; position: relative; box-shadow: 0 0 25px rgba(0,0,0,0.05); backdrop-filter: blur(5px); }
        .brand-header { background: linear-gradient(135deg, #9F2A2F 0%, #6d1519 100%); color: #fff; border-bottom: 3px solid #d97706; border-radius: 0 0 20px 20px; }
        .product-card { transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1); }
        .product-card.active { border-color: #9F2A2F; background-color: #fff1f2; transform: translateY(-2px); box-shadow: 0 4px 12px rgba(159, 42, 47, 0.1); }
        .btn-press:active { transform: scale(0.95); }
        @keyframes slideInUp { from { transform: translate(-50%, 100%); opacity: 0; } to { transform: translate(-50%, 0); opacity: 1; } }
        .toast-enter { animation: slideInUp 0.3s ease-out forwards; }
        ::-webkit-scrollbar { width: 0px; background: transparent; }
    </style>
</head>
<body>

    <div class="app-container flex flex-col">
        <!-- Header -->
        <header class="brand-header sticky top-0 z-20 px-5 py-5 flex justify-between items-center shadow-lg mb-2">
            <div class="flex items-center gap-3">
                <div class="w-11 h-11 bg-white rounded-full flex items-center justify-center text-sathu-red-600 font-bold shadow-md border-2 border-sathu-gold-500">
                    <span class="material-icons-round text-2xl">local_florist</span>
                </div>
                <div>
                    <h1 class="font-bold text-white text-lg leading-tight tracking-wide drop-shadow-sm">‡∏£‡πâ‡∏≤‡∏ô‡∏î‡∏≠‡∏Å‡πÑ‡∏°‡πâ‡∏™‡∏≤‡∏ò‡∏∏</h1>
                    <p class="text-[11px] text-white/80 font-light">‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏ö‡∏∏‡∏ç‡∏ñ‡∏∂‡∏á‡∏ó‡∏µ‡πà (‡∏≠‡∏∏‡∏î‡∏£‡∏ò‡∏≤‡∏ô‡∏µ)</p>
                </div>
            </div>
            <div class="bg-black/20 backdrop-blur-md border border-white/10 text-white px-3 py-1.5 rounded-full text-[10px] font-bold flex items-center gap-1.5 shadow-inner">
                <span class="w-2 h-2 bg-green-400 rounded-full animate-pulse shadow-[0_0_8px_#4ade80]"></span> ‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡∏±‡∏ö‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå
            </div>
        </header>

        <!-- Content -->
        <main class="flex-1 p-4 space-y-8 pb-36">
            <!-- Step 1: Product List -->
            <section>
                <div class="flex items-center gap-2 mb-4">
                    <span class="bg-sathu-red-100 text-sathu-red-600 w-7 h-7 rounded-full flex items-center justify-center text-sm font-bold border border-sathu-red-200 shadow-sm">1</span>
                    <h2 class="font-bold text-gray-800 text-lg">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏∏‡∏î‡∏î‡∏≠‡∏Å‡πÑ‡∏°‡πâ <span class="text-xs font-normal text-gray-500">(10.- ‡∏ó‡∏∏‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)</span></h2>
                </div>
                <div class="space-y-3" id="product-list"></div>
            </section>

            <div class="border-b border-dashed border-gray-300"></div>

            <!-- Step 2: Date & Location -->
            <section>
                <div class="flex items-center gap-2 mb-4">
                    <span class="bg-sathu-red-100 text-sathu-red-600 w-7 h-7 rounded-full flex items-center justify-center text-sm font-bold border border-sathu-red-200 shadow-sm">2</span>
                    <h2 class="font-bold text-gray-800 text-lg">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏™‡πà‡∏á</h2>
                </div>
                <div class="bg-white p-5 rounded-2xl border border-gray-100 shadow-md space-y-5">
                    <div>
                        <label class="text-xs font-bold text-gray-500 mb-1.5 block flex items-center gap-1"><span class="material-icons-round text-sm">event</span> ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ô‡∏±‡∏î‡∏£‡∏±‡∏ö</label>
                        <input type="date" id="order-date" class="w-full bg-gray-50 border border-gray-200 rounded-xl px-4 py-3 text-sm focus:outline-none focus:ring-2 focus:ring-sathu-red-500/20 focus:border-sathu-red-500 text-gray-700 transition-all">
                    </div>
                    <div>
                        <label class="text-xs font-bold text-gray-500 mb-1.5 block flex items-center gap-1"><span class="material-icons-round text-sm">schedule</span> ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏≠‡∏ö‡∏™‡πà‡∏á</label>
                        <div class="grid grid-cols-2 gap-3">
                            <label class="cursor-pointer btn-press">
                                <input type="radio" name="timeslot" value="‡∏£‡∏≠‡∏ö‡πÄ‡∏ä‡πâ‡∏≤ (07:00-09:00)" class="peer sr-only" checked>
                                <div class="text-center py-3 border border-gray-200 rounded-xl peer-checked:bg-sathu-red-500 peer-checked:text-white peer-checked:border-sathu-red-500 peer-checked:shadow-md text-sm font-medium transition-all bg-white">‚òÄÔ∏è ‡∏£‡∏≠‡∏ö‡πÄ‡∏ä‡πâ‡∏≤<br><span class="text-[10px] opacity-80">07:00-09:00</span></div>
                            </label>
                            <label class="cursor-pointer btn-press">
                                <input type="radio" name="timeslot" value="‡∏£‡∏≠‡∏ö‡πÄ‡∏¢‡πá‡∏ô (16:00-18:00)" class="peer sr-only">
                                <div class="text-center py-3 border border-gray-200 rounded-xl peer-checked:bg-sathu-red-500 peer-checked:text-white peer-checked:border-sathu-red-500 peer-checked:shadow-md text-sm font-medium transition-all bg-white">üåô ‡∏£‡∏≠‡∏ö‡πÄ‡∏¢‡πá‡∏ô<br><span class="text-[10px] opacity-80">16:00-18:00</span></div>
                            </label>
                        </div>
                    </div>
                    <div>
                        <label class="text-xs font-bold text-gray-500 mb-1.5 block flex items-center gap-1"><span class="material-icons-round text-sm">place</span> ‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏à‡∏±‡∏î‡∏™‡πà‡∏á</label>
                        <button onclick="getLocation()" id="gps-btn" class="w-full py-3 bg-blue-50 text-blue-600 rounded-xl border border-dashed border-blue-200 text-sm font-bold flex items-center justify-center gap-2 hover:bg-blue-100 transition-colors btn-press mb-2">
                            <span class="material-icons-round text-lg">near_me</span> ‡πÅ‡∏ä‡∏£‡πå‡∏û‡∏¥‡∏Å‡∏±‡∏î GPS (‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô)
                        </button>
                        <textarea id="location-note" rows="2" placeholder="‡∏à‡∏∏‡∏î‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° (‡πÄ‡∏ä‡πà‡∏ô ‡∏ö‡πâ‡∏≤‡∏ô‡∏£‡∏±‡πâ‡∏ß‡∏™‡∏µ‡∏Ç‡∏≤‡∏ß, ‡∏ù‡∏≤‡∏Å‡πÑ‡∏ß‡πâ‡∏ó‡∏µ‡πà‡∏õ‡πâ‡∏≠‡∏°‡∏¢‡∏≤‡∏°)" class="w-full bg-gray-50 border border-gray-200 rounded-xl px-4 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-sathu-red-500/20 focus:border-sathu-red-500 resize-none"></textarea>
                        <p id="gps-status" class="text-[10px] text-green-600 mt-1 text-center hidden flex items-center justify-center gap-1"><span class="material-icons-round text-sm">check_circle</span> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏û‡∏¥‡∏Å‡∏±‡∏î‡πÅ‡∏•‡πâ‡∏ß</p>
                    </div>
                    <div class="grid grid-cols-2 gap-3 pt-2 border-t border-gray-100">
                        <input type="text" id="customer-name" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô" class="bg-gray-50 border border-gray-200 rounded-xl px-4 py-3 text-sm focus:outline-none focus:ring-2 focus:ring-sathu-red-500/20 focus:border-sathu-red-500">
                        <input type="tel" id="customer-phone" placeholder="‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£" class="bg-gray-50 border border-gray-200 rounded-xl px-4 py-3 text-sm focus:outline-none focus:ring-2 focus:ring-sathu-red-500/20 focus:border-sathu-red-500">
                    </div>
                </div>
            </section>

            <div class="border-b border-dashed border-gray-300"></div>

            <!-- Step 3: Payment -->
            <section>
                <div class="flex items-center gap-2 mb-4">
                    <span class="bg-sathu-red-100 text-sathu-red-600 w-7 h-7 rounded-full flex items-center justify-center text-sm font-bold border border-sathu-red-200 shadow-sm">3</span>
                    <h2 class="font-bold text-gray-800 text-lg">‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</h2>
                </div>
                <div class="bg-white p-6 rounded-2xl border border-gray-100 shadow-md text-center relative overflow-hidden">
                    <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-sathu-gold-400 to-sathu-red-500"></div>
                    <p class="text-xs text-gray-500 mb-1">‡∏¢‡∏≠‡∏î‡∏ä‡∏≥‡∏£‡∏∞‡∏£‡∏ß‡∏°</p>
                    <p class="text-5xl font-bold text-sathu-red-600 mb-5 tracking-tight drop-shadow-sm" id="display-total">‡∏ø0</p>
                    <div class="flex flex-col items-center gap-4">
                        <div class="bg-white p-3 rounded-xl border-2 border-sathu-gold-400 shadow-sm relative group">
                            <img id="qr-image" src="https://placehold.co/200x200?text=Loading..." class="w-40 h-40 object-contain mix-blend-multiply" referrerpolicy="no-referrer">
                            <div class="absolute -bottom-3 -right-3 bg-sathu-red-600 text-white w-8 h-8 rounded-full flex items-center justify-center shadow-md border-2 border-white"><span class="material-icons-round text-sm">qr_code_2</span></div>
                        </div>
                        <div class="text-center w-full">
                            <div class="flex items-center justify-center gap-2 mb-1">
                                <span class="text-sathu-red-600 font-bold text-xl tracking-wide" id="acc-no"></span>
                                <button onclick="copyToClipboard()" class="text-gray-400 hover:text-sathu-red-600 transition-colors" title="‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ç‡∏ä‡∏µ"><span class="material-icons-round text-lg">content_copy</span></button>
                            </div>
                            <p class="text-xs text-gray-500">‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏û‡∏¢‡πå: <span id="acc-name"></span></p>
                        </div>
                    </div>
                    <div class="mt-6 pt-4 border-t border-gray-100">
                        <label class="flex flex-col items-center justify-center gap-2 w-full py-4 bg-sathu-red-50 text-sathu-red-600 rounded-xl border-2 border-dashed border-sathu-red-200 cursor-pointer hover:bg-sathu-red-100 transition-all btn-press group">
                            <span class="material-icons-round text-3xl group-hover:scale-110 transition-transform">cloud_upload</span>
                            <span class="text-sm font-bold" id="slip-text">‡∏Å‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏ô‡∏ö‡∏™‡∏•‡∏¥‡∏õ‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</span>
                            <input type="file" id="slip-file" class="hidden" accept="image/*" onchange="uploadSlip(this)">
                        </label>
                    </div>
                </div>
            </section>
        </main>

        <!-- Floating Bottom Bar -->
        <div class="fixed bottom-0 left-0 right-0 bg-white/95 backdrop-blur-md border-t border-gray-200 p-4 shadow-[0_-5px_20px_rgba(0,0,0,0.05)] z-30 max-w-[420px] mx-auto">
            <div class="flex justify-between items-center mb-3 px-1">
                <div class="text-xs text-gray-500 flex items-center gap-1"><span class="bg-gray-100 text-gray-600 px-2 py-0.5 rounded-md font-bold" id="total-items-count">0</span> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</div>
                <div class="text-2xl font-bold text-sathu-red-600" id="bottom-total">‡∏ø0</div>
            </div>
            <button onclick="confirmOrder()" id="confirm-btn" class="w-full bg-gradient-to-r from-sathu-red-600 to-sathu-red-500 text-white py-3.5 rounded-xl font-bold shadow-lg shadow-sathu-red-500/30 disabled:opacity-50 disabled:cursor-not-allowed disabled:shadow-none flex items-center justify-center gap-2 btn-press transition-all">
                <span>‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</span><span class="material-icons-round text-lg">arrow_forward</span>
            </button>
        </div>

        <!-- Custom Toast Notification -->
        <div id="toast" class="fixed bottom-28 left-1/2 transform -translate-x-1/2 bg-gray-800 text-white px-4 py-2 rounded-lg shadow-lg text-sm flex items-center gap-2 z-50 opacity-0 pointer-events-none transition-opacity duration-300 w-max max-w-[90%]">
            <span class="material-icons-round text-green-400 text-base">check_circle</span><span id="toast-message">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</span>
        </div>

        <!-- Success Modal -->
        <div id="success-modal" class="fixed inset-0 z-50 flex items-center justify-center pointer-events-none opacity-0 transition-opacity duration-300 px-4">
            <div class="absolute inset-0 bg-sathu-red-900/60 backdrop-blur-sm" onclick="closeModal()"></div>
            <div class="bg-white w-full max-w-sm rounded-3xl p-8 shadow-2xl transform scale-95 transition-transform duration-300 relative z-10 text-center" id="modal-content">
                <div class="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-5 text-green-500 shadow-inner border-4 border-white"><span class="material-icons-round text-5xl">check</span></div>
                <h2 class="text-2xl font-bold text-gray-800 mb-1">‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!</h2>
                <p class="text-sm text-gray-500 mb-6">‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡πÇ‡∏°‡∏ó‡∏ô‡∏≤‡∏ö‡∏∏‡∏ç üôè<br>‡∏ó‡∏≤‡∏á‡∏£‡πâ‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß</p>
                <div class="bg-gray-50 p-4 rounded-xl text-left text-sm text-gray-600 mb-6 border border-gray-100" id="order-summary-text"></div>
                <button onclick="closeModal()" class="w-full bg-gray-800 text-white py-3.5 rounded-xl font-bold hover:bg-gray-900 transition-colors">‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á</button>
            </div>
        </div>
        
        <!-- Loading Overlay -->
        <div id="loading-overlay" class="fixed inset-0 z-[60] flex flex-col items-center justify-center bg-white/90 backdrop-blur-sm hidden">
            <div class="loading-spinner w-12 h-12 border-4 mb-4 text-sathu-red-500"></div>
            <p class="text-sathu-red-600 font-bold animate-pulse">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</p>
        </div>
    </div>

    <script>
        // --- 1. ‡πÅ‡∏õ‡∏•‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå Drive ‡πÄ‡∏õ‡πá‡∏ô Thumbnail Link (‡πÇ‡∏ä‡∏ß‡πå‡∏£‡∏π‡∏õ‡πÑ‡∏î‡πâ‡∏ä‡∏±‡∏ß‡∏£‡πå) ---
        function getDirectDriveLink(url) {
            if (!url || url.trim() === '') return 'https://placehold.co/300?text=No+Image';
            
            try {
                let fileId = '';
                // ‡∏´‡∏≤ ID ‡∏à‡∏≤‡∏Å‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏ï‡πà‡∏≤‡∏á‡πÜ
                if (url.includes('/file/d/')) {
                    fileId = url.split('/file/d/')[1].split('/')[0];
                } else if (url.includes('id=')) {
                    fileId = url.split('id=')[1].split('&')[0];
                }

                if (fileId) {
                    // ‡πÉ‡∏ä‡πâ‡∏•‡∏¥‡∏á‡∏Å‡πå Thumbnail ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏™‡∏π‡∏á (sz=w1000) ‡πÅ‡∏ó‡∏ô uc?export=view
                    return `https://drive.google.com/thumbnail?id=${fileId}&sz=w1000`;
                }
            } catch (e) { console.log('Link Error', e); }
            
            return url;
        }

        const products = [
            { id: 'lotus', name: '‡∏ä‡πà‡∏≠‡∏î‡∏≠‡∏Å‡∏ö‡∏±‡∏ß‡∏Ç‡∏≤‡∏ß', price: 10, img: getDirectDriveLink(IMAGE_LINKS.lotus) },
            { id: 'orchid', name: '‡∏ä‡πà‡∏≠‡∏Å‡∏•‡πâ‡∏ß‡∏¢‡πÑ‡∏°‡πâ‡∏°‡πà‡∏ß‡∏á', price: 10, img: getDirectDriveLink(IMAGE_LINKS.orchid) },
            { id: 'marigold', name: '‡∏ä‡πà‡∏≠‡∏î‡∏≤‡∏ß‡πÄ‡∏£‡∏∑‡∏≠‡∏á', price: 10, img: getDirectDriveLink(IMAGE_LINKS.marigold) }
        ];

        // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ QR ‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ç‡∏ä‡∏µ
        document.getElementById('acc-no').innerText = BANK_INFO.number;
        document.getElementById('acc-name').innerText = BANK_INFO.name;
        
        if (IMAGE_LINKS.qrcode && IMAGE_LINKS.qrcode.trim() !== '') {
            document.getElementById('qr-image').src = getDirectDriveLink(IMAGE_LINKS.qrcode);
        } else {
            document.getElementById('qr-image').src = `https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=PromptPay-${BANK_INFO.raw_number}`;
        }

        let cart = JSON.parse(localStorage.getItem('sathu_cart')) || {}; 
        let userLocation = '';

        function initApp() {
            renderProducts();
            updateCartUI();
            
            // Restore inputs
            if(localStorage.getItem('sathu_customer_name')) document.getElementById('customer-name').value = localStorage.getItem('sathu_customer_name');
            if(localStorage.getItem('sathu_customer_phone')) document.getElementById('customer-phone').value = localStorage.getItem('sathu_customer_phone');
        }

        function renderProducts() {
            const container = document.getElementById('product-list');
            products.forEach(p => {
                if (cart[p.id] === undefined) cart[p.id] = 0;
                
                const html = `
                <div class="product-card bg-white border border-gray-100 rounded-2xl p-3 flex gap-4 items-center shadow-sm hover:shadow-md" id="card-${p.id}">
                    <div class="w-24 h-24 rounded-xl overflow-hidden bg-gray-100 flex-shrink-0 relative border border-gray-100 shadow-inner group">
                        <img src="${p.img}" class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110" referrerpolicy="no-referrer" onerror="this.src='https://placehold.co/300?text=Image+Error';">
                    </div>
                    <div class="flex-1 min-w-0 py-1">
                        <h3 class="font-bold text-gray-800 text-base truncate mb-1">${p.name}</h3>
                        <p class="text-sathu-red-600 font-bold text-lg">‡∏ø${p.price} <span class="text-xs font-normal text-gray-400">/ ‡∏Å‡∏≥</span></p>
                    </div>
                    <div class="flex flex-col items-center gap-1 bg-gray-50 rounded-xl p-1.5 border border-gray-100">
                        <button onclick="updateQty('${p.id}', 1)" class="w-8 h-8 flex items-center justify-center bg-white text-sathu-red-600 rounded-lg shadow-sm border border-gray-200 active:scale-90 transition-transform"><span class="material-icons-round text-sm font-bold">add</span></button>
                        <span class="h-6 flex items-center font-bold text-gray-800 text-sm" id="qty-${p.id}">${cart[p.id]}</span>
                        <button onclick="updateQty('${p.id}', -1)" class="w-8 h-8 flex items-center justify-center bg-white text-gray-400 rounded-lg shadow-sm border border-gray-200 active:scale-90 transition-transform disabled:opacity-50" id="btn-minus-${p.id}" ${cart[p.id] === 0 ? 'disabled' : ''}><span class="material-icons-round text-sm font-bold">remove</span></button>
                    </div>
                </div>`;
                container.insertAdjacentHTML('beforeend', html);
            });
            updateProductHighlight();
        }

        function updateQty(id, change) {
            const newVal = (cart[id] || 0) + change;
            if (newVal >= 0) {
                cart[id] = newVal;
                document.getElementById(`qty-${id}`).innerText = newVal;
                document.getElementById(`btn-minus-${id}`).disabled = (newVal === 0);
                updateProductHighlight(id);
                updateCartUI();
                saveState();
            }
        }

        function updateProductHighlight(specificId = null) {
            const ids = specificId ? [specificId] : products.map(p => p.id);
            ids.forEach(id => {
                const card = document.getElementById(`card-${id}`);
                if (cart[id] > 0) card.classList.add('active');
                else card.classList.remove('active');
            });
        }

        function updateCartUI() {
            let total = 0;
            let count = 0;
            products.forEach(p => { 
                const qty = cart[p.id] || 0;
                total += qty * p.price; 
                count += qty; 
            });
            document.getElementById('display-total').innerText = `‡∏ø${total}`;
            document.getElementById('bottom-total').innerText = `‡∏ø${total}`;
            document.getElementById('total-items-count').innerText = count;
            const confirmBtn = document.getElementById('confirm-btn');
            if (count === 0) {
                confirmBtn.disabled = true; confirmBtn.classList.add('opacity-50', 'grayscale');
            } else {
                confirmBtn.disabled = false; confirmBtn.classList.remove('opacity-50', 'grayscale');
            }
        }

        function saveState() {
            localStorage.setItem('sathu_cart', JSON.stringify(cart));
            localStorage.setItem('sathu_customer_name', document.getElementById('customer-name').value);
            localStorage.setItem('sathu_customer_phone', document.getElementById('customer-phone').value);
        }

        document.getElementById('customer-name').addEventListener('input', saveState);
        document.getElementById('customer-phone').addEventListener('input', saveState);

        function copyToClipboard() {
            navigator.clipboard.writeText(BANK_INFO.raw_number).then(() => showToast("‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÅ‡∏•‡πâ‡∏ß"));
        }

        function showToast(message) {
            const toast = document.getElementById('toast');
            document.getElementById('toast-message').innerText = message;
            toast.classList.remove('opacity-0', 'pointer-events-none');
            toast.classList.add('toast-enter');
            setTimeout(() => { toast.classList.remove('toast-enter'); toast.classList.add('opacity-0', 'pointer-events-none'); }, 3000);
        }

        function getLocation() {
            const btn = document.getElementById('gps-btn');
            const status = document.getElementById('gps-status');
            btn.innerHTML = '<div class="loading-spinner w-4 h-4 border-2"></div> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏£‡∏∞‡∏ö‡∏∏...';
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (pos) => {
                        userLocation = `${pos.coords.latitude.toFixed(6)}, ${pos.coords.longitude.toFixed(6)}`;
                        btn.classList.replace('bg-blue-50', 'bg-green-50'); btn.classList.replace('text-blue-600', 'text-green-600');
                        btn.classList.replace('border-blue-200', 'border-green-200'); btn.classList.remove('border-dashed');
                        btn.innerHTML = '<span class="material-icons-round text-lg">place</span> ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏û‡∏¥‡∏Å‡∏±‡∏î‡πÅ‡∏•‡πâ‡∏ß';
                        status.classList.remove('hidden'); status.innerHTML = `<span class="material-icons-round text-sm">check_circle</span> ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏û‡∏¥‡∏Å‡∏±‡∏î‡πÅ‡∏•‡πâ‡∏ß (${userLocation})`;
                        showToast("‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏û‡∏¥‡∏Å‡∏±‡∏î GPS ‡πÅ‡∏•‡πâ‡∏ß");
                    },
                    () => {
                        userLocation = '17.41500, 102.78600 (Mock)';
                        showToast("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏£‡∏∞‡∏ö‡∏∏‡∏û‡∏¥‡∏Å‡∏±‡∏î‡πÑ‡∏î‡πâ ‡πÉ‡∏ä‡πâ‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏à‡∏≥‡∏•‡∏≠‡∏á");
                        status.classList.remove('hidden'); status.innerHTML = `<span class="material-icons-round text-sm text-yellow-600">warning</span> ‡πÉ‡∏ä‡πâ‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏à‡∏≥‡∏•‡∏≠‡∏á`;
                        btn.innerHTML = '‡∏•‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏∏‡πÉ‡∏´‡∏°‡πà';
                    }
                );
            }
        }

        function uploadSlip(input) {
            const text = document.getElementById('slip-text');
            if (input.files && input.files[0]) {
                text.innerText = '‡πÅ‡∏ô‡∏ö‡πÅ‡∏•‡πâ‡∏ß: ' + input.files[0].name.substring(0, 15) + '...';
                const container = input.parentElement;
                container.classList.replace('bg-sathu-red-50', 'bg-green-50'); container.classList.replace('text-sathu-red-600', 'text-green-600');
                container.classList.replace('border-sathu-red-200', 'border-green-200'); container.classList.replace('border-dashed', 'border-solid');
                showToast("‡πÅ‡∏ô‡∏ö‡∏™‡∏•‡∏¥‡∏õ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢");
            }
        }

        function confirmOrder() {
            if (document.getElementById('bottom-total').innerText === '‡∏ø0') return showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Å‡πà‡∏≠‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö');
            if (!WEB_APP_URL || WEB_APP_URL.includes('/exec') === false) return alert('‚ö†Ô∏è Error: Web App URL ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á');

            const date = document.getElementById('order-date').value;
            const name = document.getElementById('customer-name').value;
            const phone = document.getElementById('customer-phone').value;
            const locationNote = document.getElementById('location-note').value;
            const slipFile = document.getElementById('slip-file').files[0];
            
            if (!date) { document.getElementById('order-date').focus(); return showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ô‡∏±‡∏î‡∏£‡∏±‡∏ö'); }
            if (!name) { document.getElementById('customer-name').focus(); return showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠'); }
            if (!phone) { document.getElementById('customer-phone').focus(); return showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£'); }
            if (!userLocation) return showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏î‡πÅ‡∏ä‡∏£‡πå‡∏û‡∏¥‡∏Å‡∏±‡∏î GPS');

            document.getElementById('loading-overlay').classList.remove('hidden');

            let itemSummary = [];
            products.forEach(p => { if (cart[p.id] > 0) itemSummary.push(`${p.name} x${cart[p.id]}`); });
            const fullLocation = locationNote ? `${userLocation} (${locationNote})` : userLocation;

            const orderData = {
                items: itemSummary.join(', '), totalPrice: document.getElementById('bottom-total').innerText,
                date: date, timeslot: document.querySelector('input[name="timeslot"]:checked').value,
                location: fullLocation, name: name, phone: phone, slipImage: null
            };

            if (slipFile) {
                const reader = new FileReader();
                reader.onload = function(e) { orderData.slipImage = e.target.result; sendToGoogle(orderData); };
                reader.readAsDataURL(slipFile);
            } else { sendToGoogle(orderData); }
        }

        function sendToGoogle(data) {
            fetch(WEB_APP_URL, {
                method: 'POST', redirect: 'follow', headers: { "Content-Type": "text/plain;charset=utf-8" }, body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(responseData => {
                if (responseData.success) onSuccess();
                else throw new Error(responseData.message);
            })
            .catch(error => {
                console.error('Error:', error); alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠: ' + error);
                document.getElementById('loading-overlay').classList.add('hidden');
            });
        }

        function onSuccess() {
            document.getElementById('loading-overlay').classList.add('hidden');
            cart = {}; products.forEach(p => cart[p.id] = 0); localStorage.removeItem('sathu_cart');
            updateCartUI(); renderProducts(); document.getElementById('product-list').innerHTML = ''; renderProducts();
            
            let summaryHtml = `<div class="font-bold text-sathu-red-600">‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏£‡∏±‡∏ö ‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏à‡∏∞‡∏£‡∏µ‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏•‡∏∞‡∏à‡∏±‡∏î‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏î‡∏≠‡∏Å‡πÑ‡∏°‡πâ‡πÉ‡∏´‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ</div>`;
            document.getElementById('order-summary-text').innerHTML = summaryHtml;
            document.getElementById('success-modal').classList.remove('opacity-0', 'pointer-events-none');
            document.getElementById('modal-content').classList.remove('scale-95');
        }

        function closeModal() { window.location.reload(); }

        initApp();
    </script>
</body>
</html>
