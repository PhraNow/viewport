import React, { useState, useEffect, useRef } from 'react';
import { 
  Spa, AutoAwesome, Home, ShoppingBag, AdminPanelSettings, 
  DarkMode, LightMode, ExpandMore, NearMe, LockPerson, 
  Logout, KeyboardDoubleArrowRight, Map, Inventory, 
  AddCircle, ContentCopy, Edit, CloudUpload, Close,
  CheckCircle, FmdGood, Info
} from '@mui/icons-material';

const App = () => {
  // --- CONFIGURATION ---
  const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbzN8p1bt_HUHaY1hTjaWypxekf5xos_pWXNi6yYOcQYoNW5vp16f4ln9xBvWJrroPWI/exec"; // üî¥ ‡∏ß‡∏≤‡∏á URL ‡∏à‡∏≤‡∏Å Google Apps Script (/exec) ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà

  // --- STATE ---
  const [isDark, setIsDark] = useState(false);
  const [screen, setScreen] = useState('home'); // home, checkout, admin, success
  const [isAdminLoggedIn, setIsAdminLoggedIn] = useState(false);
  const [showLoginModal, setShowLoginModal] = useState(false);
  const [adminPw, setAdminPw] = useState("");
  const [loginError, setLoginError] = useState(false);
  
  const [products, setProducts] = useState([
    { id: 'lotus', name: '‡∏î‡∏≠‡∏Å‡∏ö‡∏±‡∏ß‡∏®‡∏¥‡∏•‡∏≤‡∏Ç‡∏≤‡∏ß', price: 10, stock: 50, imgId: '1yTbEv2lg8FU-_4jaXgV8yqpVt_71laKG' },
    { id: 'orchid', name: '‡∏Å‡∏•‡πâ‡∏ß‡∏¢‡πÑ‡∏°‡πâ‡∏°‡πà‡∏ß‡∏á‡∏™‡∏¥‡∏£‡∏¥', price: 10, stock: 30, imgId: '1J1Eq279p2AO2nSI6MH4TZyXgkepQ6JkM' }
  ]);
  
  const [cart, setCart] = useState({});
  const [formData, setFormData] = useState({
    name: "",
    phone: "",
    address: "", // ‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà/‡∏à‡∏∏‡∏î‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï
    prayer: "",
    location: "" // GPS
  });

  const [isLoading, setIsLoading] = useState(false);
  const [toast, setToast] = useState({ show: false, msg: "" });
  const [adminTab, setAdminTab] = useState('stock'); // stock, map
  const [showAddProduct, setShowAddProduct] = useState(false);

  // --- REFS ---
  const sliderRef = useRef(null);
  const knobRef = useRef(null);

  // --- INITIALIZE ---
  useEffect(() => {
    // Initial fetch from DB could be here
  }, []);

  // --- HELPERS ---
  const getImageUrl = (id) => `https://drive.google.com/thumbnail?id=${id}&sz=w1000`;
  
  const toggleTheme = () => setIsDark(!isDark);

  const showToast = (msg) => {
    setToast({ show: true, msg });
    setTimeout(() => setToast({ show: false, msg: "" }), 3000);
  };

  const updateQty = (id, delta) => {
    setCart(prev => {
      const newQty = (prev[id] || 0) + delta;
      if (newQty <= 0) {
        const { [id]: _, ...rest } = prev;
        return rest;
      }
      return { ...prev, [id]: newQty };
    });
    if (window.navigator.vibrate) window.navigator.vibrate(20);
  };

  const totalAmount = Object.keys(cart).reduce((sum, id) => {
    const p = products.find(prod => prod.id === id);
    return sum + (cart[id] * (p?.price || 0));
  }, 0);

  // --- ADMIN LOGIC ---
  const handleAdminLogin = () => {
    if (adminPw === "8888") {
      setIsAdminLoggedIn(true);
      setShowLoginModal(false);
      setScreen('admin');
      setAdminPw("");
      setLoginError(false);
    } else {
      setLoginError(true);
      if (window.navigator.vibrate) window.navigator.vibrate(50);
    }
  };

  const handleAddProduct = (e) => {
    e.preventDefault();
    const form = e.target;
    const newP = {
      id: Date.now().toString(),
      name: form.pname.value,
      price: parseInt(form.pprice.value),
      stock: parseInt(form.pstock.value),
      imgId: form.pimg.value
    };
    setProducts([...products, newP]);
    setShowAddProduct(false);
    showToast("‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢");
  };

  // --- GPS ---
  const handleGetLocation = () => {
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(
        (pos) => {
          const loc = `${pos.coords.latitude.toFixed(6)}, ${pos.coords.longitude.toFixed(6)}`;
          setFormData({ ...formData, location: loc });
          showToast("‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏û‡∏¥‡∏Å‡∏±‡∏î GPS ‡πÅ‡∏•‡πâ‡∏ß");
        },
        () => {
          setFormData({ ...formData, location: "17.41500, 102.78600 (‡∏à‡∏≥‡∏•‡∏≠‡∏á)" });
          showToast("GPS ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ ‡πÉ‡∏ä‡πâ‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏à‡∏≥‡∏•‡∏≠‡∏á");
        }
      );
    }
  };

  // --- SLIDE TO PAY LOGIC ---
  const [slideX, setSlideX] = useState(0);
  const [isDragging, setIsDragging] = useState(false);

  const onDrag = (e) => {
    if (!isDragging) return;
    const clientX = e.type.includes('touch') ? e.touches[0].clientX : e.clientX;
    const rect = sliderRef.current.getBoundingClientRect();
    const max = rect.width - knobRef.current.offsetWidth - 16;
    let delta = clientX - rect.left - 40;
    delta = Math.max(0, Math.min(delta, max));
    setSlideX(delta);
    if (delta >= max * 0.95) {
      setIsDragging(false);
      setSlideX(0);
      handleSubmitOrder();
    }
  };

  const handleSubmitOrder = async () => {
    if (!formData.name || !formData.phone || !formData.address) {
      return showToast("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏±‡∏î‡∏™‡πà‡∏á‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô");
    }
    setIsLoading(true);
    // Simulate API Call
    setTimeout(() => {
      setIsLoading(false);
      setScreen('success');
    }, 2500);
  };

  // --- RENDER HELPERS ---
  const renderBento = () => (
    <div className="grid grid-cols-4 grid-rows-2 gap-4 h-[400px] px-8 mb-16 animate-in slide-in-from-bottom-8 duration-700">
      <div className="col-span-2 row-span-2 relative rounded-[3.5rem] overflow-hidden shadow-2xl active:scale-95 transition-all border border-white dark:border-stone-800"
           onClick={() => document.getElementById('selection-area').scrollIntoView({ behavior: 'smooth' })}>
        <img src={getImageUrl(products[0]?.imgId)} className="absolute inset-0 h-full w-full object-cover" />
        <div className="absolute inset-0 bg-gradient-to-t from-black/80 via-transparent to-transparent"></div>
        <div className="absolute bottom-8 left-8 text-white"><p className="text-3xl font-logo leading-tight">‡∏ä‡∏∏‡∏î‡∏ñ‡∏ß‡∏≤‡∏¢‡∏ß‡∏¥‡∏à‡∏¥‡∏ï‡∏£</p></div>
      </div>
      <div className="col-span-2 row-span-1 relative rounded-[2.5rem] overflow-hidden shadow-lg border border-white dark:border-stone-800">
        <img src={getImageUrl(products[1]?.imgId)} className="absolute inset-0 h-full w-full object-cover" />
        <div className="absolute inset-0 bg-gradient-to-t from-black/80 via-transparent to-transparent"></div>
        <div className="absolute bottom-6 left-8 text-white"><p className="text-xl font-logo">‡∏°‡∏≤‡∏•‡∏±‡∏¢‡∏ö‡∏π‡∏ä‡∏≤</p></div>
      </div>
      <div className={`col-span-1 row-span-1 relative rounded-[2rem] flex items-center justify-center border border-sathu-gold/20 shadow-inner ${isDark ? 'bg-stone-900' : 'bg-white/80'}`}>
        <AutoAwesome className="text-[#8B2222] dark:text-[#C5A059] text-3xl" />
      </div>
      <div className="col-span-1 row-span-1 relative rounded-[2rem] bg-[#8B2222] flex items-center justify-center shadow-lg border border-sathu-gold/30">
        <Spa className="text-[#E8D5B5] text-3xl" />
      </div>
    </div>
  );

  return (
    <div className={`${isDark ? 'dark' : ''} transition-all duration-500`}>
      <div className="bg-[#F4EFE9] dark:bg-[#0F0A0A] font-sans text-[#1b0d11] dark:text-stone-200 min-h-screen selection:bg-[#8B2222]/10 overflow-x-hidden">
        
        <div className="max-w-md mx-auto min-h-screen relative shadow-2xl bg-white/10 dark:bg-black/20 silk-texture">
          
          {/* HEADER NAV */}
          <div className="fixed top-6 left-6 right-6 z-[60] flex justify-between items-center pointer-events-none">
            <button onClick={toggleTheme} className="pointer-events-auto w-12 h-12 rounded-full glass-premium flex items-center justify-center active:scale-90 transition-all shadow-lg">
              {isDark ? <LightMode className="text-[#C5A059]" /> : <DarkMode className="text-[#C5A059]" />}
            </button>
            <button onClick={() => isAdminLoggedIn ? setScreen('admin') : setShowLoginModal(true)} 
                    className="pointer-events-auto w-12 h-12 rounded-full glass-premium flex items-center justify-center active:scale-90 transition-all shadow-lg">
              <AdminPanelSettings className="text-stone-400" />
            </button>
          </div>

          {/* SCREEN: HOME */}
          {screen === 'home' && (
            <div className="pb-40 animate-in fade-in duration-1000">
              <div className="relative h-[90vh] w-full overflow-hidden">
                <div className="absolute inset-0 bg-cover bg-center scale-105 animate-pulse transition-all duration-[10s]" 
                     style={{ backgroundImage: `url('https://images.unsplash.com/photo-1508608226934-2e928286a1df?q=80&w=1200')` }}>
                  <div className="absolute inset-0 bg-gradient-to-b from-black/40 via-transparent to-[#F4EFE9] dark:to-[#0F0A0A]"></div>
                </div>
                <div className="absolute inset-0 flex flex-col items-center justify-center p-8 text-center">
                  <div className="bg-[#8B2222] px-16 py-14 rounded-[4.5rem] border-[4px] border-[#C5A059] shadow-2xl">
                    <h1 className="font-logo text-[110px] text-[#E8D5B5] leading-none mb-3">‡∏™‡∏≤‡∏ò‡∏∏</h1>
                    <p className="text-[#C5A059] text-[10px] tracking-[0.8em] uppercase font-bold opacity-80">Digital Nirvana</p>
                  </div>
                </div>
              </div>

              {renderBento()}

              <div id="selection-area" className="px-8 pb-10">
                <div className="flex items-center justify-between mb-12">
                  <h2 className="text-4xl font-logo font-bold text-[#8B2222] dark:text-[#C5A059]">‡∏†‡∏≤‡∏ä‡∏ô‡∏∞‡πÅ‡∏´‡πà‡∏á‡πÅ‡∏™‡∏á</h2>
                  <div className="bg-[#8B2222] px-6 py-2 rounded-full shadow-lg border border-[#C5A059]">
                    <span className="text-white font-bold tracking-widest uppercase">‡∏ø{products[0]?.price}</span>
                  </div>
                </div>

                <div className="space-y-12">
                  {products.map(p => (
                    <div key={p.id} className="group relative rounded-[4.5rem] overflow-hidden shadow-2xl active:scale-[0.98] transition-all" onClick={() => updateQty(p.id, 1)}>
                      <div className="aspect-[16/11] overflow-hidden">
                        <img src={getImageUrl(p.imgId)} className="w-full h-full object-cover grayscale-[0.2] group-hover:grayscale-0 transition-all duration-[3s] group-hover:scale-110" />
                      </div>
                      <div className="absolute inset-0 bg-gradient-to-t from-black/95 via-transparent to-transparent"></div>
                      {cart[p.id] > 0 && (
                        <div className="absolute top-8 right-10 bg-white dark:bg-stone-900 text-[#8B2222] dark:text-[#C5A059] w-16 h-16 rounded-full flex items-center justify-center text-3xl font-logo shadow-2xl border-[6px] border-[#C5A059] animate-pop">
                          {cart[p.id]}
                        </div>
                      )}
                      <div className="absolute bottom-10 left-12 text-white">
                        <h3 className="text-4xl font-logo mb-1 text-[#E8D5B5]">{p.name}</h3>
                        <p className="text-[11px] opacity-60 uppercase tracking-widest font-bold">In-Stock: {p.stock}</p>
                      </div>
                    </div>
                  ))}
                </div>
              </div>
            </div>
          )}

          {/* SCREEN: CHECKOUT */}
          {screen === 'checkout' && (
            <div className="pt-24 px-10 pb-64 animate-in slide-in-from-right duration-700 transition-all">
              <button onClick={() => setScreen('home')} className="mb-14 flex items-center gap-4 text-[#8B2222] dark:text-[#C5A059] text-[12px] font-bold uppercase tracking-widest bg-white dark:bg-stone-900 shadow-xl border border-[#C5A059]/30 px-8 py-4 rounded-full">
                <Home fontSize="small" /> ‡∏Å‡∏•‡∏±‡∏ö‡∏™‡∏π‡πà‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å
              </button>
              
              <h2 className="text-[80px] font-logo font-bold mb-20 tracking-tighter text-[#8B2222] dark:text-stone-300 leading-none">‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÑ‡∏ó‡∏¢<br/><span className="text-[#C5A059]">‡∏ñ‡∏ß‡∏≤‡∏¢‡∏ö‡∏π‡∏ä‡∏≤</span></h2>

              <div className="space-y-12">
                {Object.keys(cart).map(id => {
                  const p = products.find(prod => prod.id === id);
                  return (
                    <div key={id} className="flex items-center justify-between border-b border-[#C5A059]/20 pb-8">
                      <div className="flex items-center gap-10">
                        <div className="w-32 h-32 rounded-[3.5rem] overflow-hidden shadow-2xl border-4 border-white dark:border-stone-800">
                          <img src={getImageUrl(p.imgId)} className="w-full h-full object-cover" />
                        </div>
                        <div>
                          <p className="font-logo font-bold text-4xl text-[#8B2222] dark:text-stone-100">{p.name}</p>
                          <div className="flex items-center gap-3 mt-4">
                            <button onClick={() => updateQty(id, -1)} className="w-8 h-8 rounded-full bg-stone-100 dark:bg-stone-800 flex items-center justify-center active:scale-90"><Close fontSize="small"/></button>
                            <p className="text-xl font-bold uppercase tracking-widest">x{cart[id]}</p>
                            <button onClick={() => updateQty(id, 1)} className="w-8 h-8 rounded-full bg-[#8B2222] text-white flex items-center justify-center active:scale-90"><KeyboardDoubleArrowRight fontSize="small"/></button>
                          </div>
                        </div>
                      </div>
                      <p className="font-bold text-4xl text-[#8B2222] dark:text-[#C5A059]">‡∏ø{cart[id] * p.price}</p>
                    </div>
                  );
                })}

                <div className="pt-16 space-y-16 border-t-4 border-[#C5A059]">
                  <div className="space-y-8">
                    <h3 className="text-xs font-bold uppercase tracking-widest text-[#C5A059] border-l-4 border-[#8B2222] pl-4">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏™‡πà‡∏á</h3>
                    
                    <div onClick={handleGetLocation} className="glass-premium p-8 rounded-[4rem] flex items-center justify-between active:scale-95 transition-all shadow-xl">
                      <div className="flex items-center gap-8">
                        <div className={`w-16 h-16 rounded-[2rem] flex items-center justify-center shadow-inner ${formData.location ? 'bg-green-600 text-white' : 'bg-stone-900 text-[#C5A059]'}`}>
                          <NearMe />
                        </div>
                        <div>
                          <p className="text-[11px] font-bold text-stone-400 uppercase tracking-widest">GPS Position</p>
                          <p className="text-lg font-bold tracking-tight">{formData.location ? "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏û‡∏¥‡∏Å‡∏±‡∏î‡πÅ‡∏•‡πâ‡∏ß" : "‡πÅ‡∏ä‡∏£‡πå‡∏û‡∏¥‡∏Å‡∏±‡∏î GPS ‡∏Ç‡∏≠‡∏á‡∏ó‡πà‡∏≤‡∏ô"}</p>
                        </div>
                      </div>
                    </div>

                    <input type="text" value={formData.name} onChange={e=>setFormData({...formData, name: e.target.value})} placeholder="‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô" className="w-full bg-white dark:bg-stone-900 border-2 border-[#C5A059]/20 rounded-[2.5rem] px-8 py-6 text-xl focus:ring-4 focus:ring-[#8B2222]/10 transition-all font-serif outline-none" />
                    <input type="tel" value={formData.phone} onChange={e=>setFormData({...formData, phone: e.target.value})} placeholder="‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠" className="w-full bg-white dark:bg-stone-900 border-2 border-[#C5A059]/20 rounded-[2.5rem] px-8 py-6 text-xl focus:ring-4 focus:ring-[#8B2222]/10 transition-all font-serif outline-none" />
                    <textarea value={formData.address} onChange={e=>setFormData({...formData, address: e.target.value})} placeholder="‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà / ‡∏à‡∏∏‡∏î‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï (‡πÄ‡∏ä‡πà‡∏ô ‡∏£‡∏±‡πâ‡∏ß‡∏™‡∏µ‡∏Ç‡∏≤‡∏ß, ‡∏ß‡∏≤‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏ö‡πâ‡∏≤‡∏ô)" className="w-full bg-white dark:bg-stone-900 border-2 border-[#C5A059]/20 rounded-[3rem] px-8 py-6 text-xl focus:ring-4 focus:ring-[#8B2222]/10 transition-all font-serif outline-none min-h-[120px] resize-none" />
                    
                    <h3 className="text-xs font-bold uppercase tracking-widest text-[#C5A059] border-l-4 border-[#8B2222] pl-4">‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏©‡∏ê‡∏≤‡∏ô‡∏à‡∏¥‡∏ï / ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</h3>
                    <textarea value={formData.prayer} onChange={e=>setFormData({...formData, prayer: e.target.value})} placeholder="‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏Ñ‡∏≥‡∏≠‡∏∏‡∏ó‡∏¥‡∏®‡∏™‡πà‡∏ß‡∏ô‡∏Å‡∏∏‡∏®‡∏•..." className="w-full glass-premium p-10 rounded-[4rem] text-2xl italic text-stone-800 dark:text-stone-200 placeholder:text-stone-300 min-h-[220px] resize-none leading-relaxed font-serif outline-none" />
                  </div>

                  {/* QR PAYMENT SECTION */}
                  <div className="bg-stone-900 dark:bg-stone-950 p-10 rounded-[4.5rem] text-center border-4 border-[#C5A059] shadow-2xl relative overflow-hidden">
                    <div className="absolute top-0 left-0 w-full h-2 shimmer opacity-30"></div>
                    <p className="text-[#C5A059] uppercase tracking-[0.5em] text-[10px] mb-8 font-bold">QR Payment Service</p>
                    <div className="bg-white p-6 rounded-[3rem] shadow-inner inline-block mb-10 border-[6px] border-[#8B2222]">
                      <img src="https://lh3.googleusercontent.com/d/1g1z-sT8BDFYhbxph8uim7fzgtko42Pwd" className="w-48 h-48 mix-blend-multiply" />
                    </div>
                    <div className="text-white space-y-2 mb-10">
                      <p className="text-4xl font-serif font-bold tracking-widest">084-793-6665</p>
                      <p className="text-[11px] text-[#C5A059] uppercase tracking-widest">‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏û‡∏¢‡πå: ‡∏ß‡∏¥‡∏ó‡∏¢‡πå‡∏™‡∏£‡∏±‡∏ä ‡∏™‡∏∏‡∏à‡∏≤‡∏£‡∏µ (‡∏£‡πâ‡∏≤‡∏ô‡∏™‡∏≤‡∏ò‡∏∏)</p>
                      <button onClick={() => { navigator.clipboard.writeText("0847936665"); showToast("‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÅ‡∏•‡πâ‡∏ß"); }} 
                              className="mt-4 inline-flex items-center gap-2 bg-white/10 px-6 py-2 rounded-full text-xs font-bold hover:bg-white/20 transition-all active:scale-95">
                        <ContentCopy fontSize="small" /> COPY NUMBER
                      </button>
                    </div>
                  </div>

                  <div className="flex justify-between items-baseline pt-10">
                    <span className="text-[#C5A059] font-bold uppercase tracking-widest text-xs">TOTAL MERIT</span>
                    <span className="text-[90px] font-bold text-[#8B2222] dark:text-[#E8D5B5] tracking-tighter leading-none">‡∏ø{totalAmount}</span>
                  </div>

                  {/* SLIDE TO PAY */}
                  <div ref={sliderRef} className="relative h-36 bg-stone-900 dark:bg-stone-950 rounded-full p-4 overflow-hidden shadow-2xl flex items-center border-4 border-[#C5A059]">
                    <div className="absolute inset-0 flex items-center justify-center pointer-events-none">
                      <span className="text-[14px] font-bold text-[#E8D5B5] uppercase tracking-[0.7em] animate-pulse">‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ñ‡∏ß‡∏≤‡∏¢‡∏ö‡∏∏‡∏ç</span>
                    </div>
                    <div ref={knobRef} 
                         style={{ transform: `translateX(${slideX}px)` }}
                         onMouseDown={() => setIsDragging(true)}
                         onTouchStart={() => setIsDragging(true)}
                         onMouseMove={onDrag}
                         onTouchMove={onDrag}
                         onMouseUp={() => { setIsDragging(false); setSlideX(0); }}
                         onTouchEnd={() => { setIsDragging(false); setSlideX(0); }}
                         className="relative h-28 w-28 rounded-full flex items-center justify-center text-white shadow-2xl cursor-grab active:cursor-grabbing z-10 shimmer"
                         style={{ background: 'linear-gradient(135deg, #C5A059 0%, #8B2222 100%)', transform: `translateX(${slideX}px)` }}>
                      <KeyboardDoubleArrowRight fontSize="large" />
                    </div>
                  </div>
                </div>
              </div>
            </div>
          )}

          {/* SCREEN: ADMIN */}
          {screen === 'admin' && (
            <div className="min-h-screen pt-24 px-10 pb-40 animate-in slide-in-from-top-10 duration-700">
              <div className="flex justify-between items-center mb-16">
                <div>
                  <h2 className="text-5xl font-logo font-bold text-[#8B2222] dark:text-[#C5A059]">‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</h2>
                  <p className="text-[11px] text-stone-400 font-bold uppercase tracking-widest mt-1">Management Portal</p>
                </div>
                <button onClick={() => { setIsAdminLoggedIn(false); setScreen('home'); }} className="w-14 h-14 rounded-full glass-premium flex items-center justify-center shadow-lg active:scale-90">
                  <Logout className="text-stone-500" />
                </button>
              </div>

              <div className="flex gap-10 mb-14 border-b-2 border-stone-100 dark:border-stone-800 px-4">
                <button onClick={() => setAdminTab('stock')} className={`pb-5 font-bold text-sm uppercase tracking-widest transition-all ${adminTab === 'stock' ? 'text-[#8B2222] border-b-4 border-[#8B2222]' : 'text-stone-400'}`}>‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</button>
                <button onClick={() => setAdminTab('map')} className={`pb-5 font-bold text-sm uppercase tracking-widest transition-all ${adminTab === 'map' ? 'text-[#8B2222] border-b-4 border-[#8B2222]' : 'text-stone-400'}`}>‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏±‡∏î‡∏™‡πà‡∏á</button>
              </div>

              {adminTab === 'stock' ? (
                <div className="space-y-12">
                  <button onClick={() => setShowAddProduct(true)} className="w-full py-8 border-4 border-dashed border-[#C5A059]/30 rounded-[3.5rem] flex flex-col items-center justify-center gap-2 text-[#C5A059] hover:bg-[#C5A059]/5 transition-all">
                    <AddCircle fontSize="large" />
                    <span className="font-bold uppercase text-xs tracking-widest">Add New Product</span>
                  </button>

                  <div className="glass-premium p-10 rounded-[4.5rem] space-y-12">
                    {products.map(p => (
                      <div key={p.id} className="flex items-center justify-between border-b border-stone-100 dark:border-stone-800 pb-10 last:border-0 last:pb-0">
                        <div className="flex items-center gap-6">
                          <div className="w-20 h-20 rounded-3xl overflow-hidden border-2 border-[#C5A059] shadow-lg">
                            <img src={getImageUrl(p.imgId)} className="object-cover h-full w-full" />
                          </div>
                          <div><p className="font-bold text-xl">{p.name}</p><p className="text-[10px] text-stone-400 uppercase">ID: {p.id}</p></div>
                        </div>
                        <div className="flex gap-4">
                          <div className="flex flex-col gap-1">
                            <label className="text-[9px] font-bold text-stone-400">Price</label>
                            <input type="number" defaultValue={p.price} className="w-16 h-12 bg-stone-100 dark:bg-stone-800 border-none rounded-xl text-center font-bold text-[#8B2222] text-lg" />
                          </div>
                          <div className="flex flex-col gap-1">
                            <label className="text-[9px] font-bold text-stone-400">Stock</label>
                            <input type="number" defaultValue={p.stock} className="w-16 h-12 bg-stone-100 dark:bg-stone-800 border-none rounded-xl text-center font-bold text-lg" />
                          </div>
                        </div>
                      </div>
                    ))}
                    <button className="w-full bg-[#8B2222] text-white py-6 rounded-full font-bold uppercase tracking-widest text-[12px] shadow-2xl shimmer">Update Database</button>
                  </div>
                </div>
              ) : (
                <div className="space-y-10 animate-in fade-in duration-700">
                  <div className="glass-premium p-4 rounded-[3.5rem] shadow-2xl border-2 border-[#C5A059] overflow-hidden">
                     <div className="h-[400px] w-full bg-stone-200 dark:bg-stone-800 rounded-[2.5rem] flex items-center justify-center flex-col gap-4 text-stone-400">
                        <Map fontSize="large" />
                        <p className="text-xs font-bold uppercase tracking-widest">MAP MODULE INITIALIZING...</p>
                        <p className="text-[10px] max-w-xs text-center px-10">‡πÅ‡∏™‡∏î‡∏á‡∏´‡∏°‡∏∏‡∏î‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ï‡∏≤‡∏°‡∏û‡∏¥‡∏Å‡∏±‡∏î GPS ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏à‡∏≤‡∏Å Google Sheets</p>
                     </div>
                  </div>
                </div>
              )}
            </div>
          )}

          {/* SCREEN: SUCCESS */}
          {screen === 'success' && (
            <div className="fixed inset-0 z-[100] bg-[#F4EFE9] dark:bg-[#0F0A0A] flex flex-col items-center justify-center text-center p-12 animate-in fade-in duration-1000">
              <div className="w-64 h-64 bg-[#8B2222] rounded-full flex items-center justify-center mb-16 relative shadow-2xl border-4 border-[#C5A059]">
                <div className="absolute inset-0 bg-white/20 rounded-full animate-ping duration-[4s]"></div>
                <Spa className="text-[#E8D5B5] text-[150px] font-thin" />
              </div>
              <h2 className="text-[100px] font-logo font-bold mb-8 text-[#8B2222] tracking-tight leading-none">‡∏≠‡∏ô‡∏∏‡πÇ‡∏°‡∏ó‡∏ô‡∏≤</h2>
              <p className="text-stone-700 dark:text-stone-300 leading-loose max-w-[380px] mx-auto mb-24 italic font-serif text-3xl transition-all">
                "‡∏Ç‡∏≠‡πÉ‡∏´‡πâ‡∏ú‡∏•‡∏ö‡∏∏‡∏ç‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ô‡∏µ‡πâ‡∏ö‡∏±‡∏ô‡∏î‡∏≤‡∏•‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∏‡∏Ç‡∏™‡∏á‡∏ö ‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏∏‡πà‡∏á‡πÄ‡∏£‡∏∑‡∏≠‡∏á‡∏°‡∏≤‡∏™‡∏π‡πà‡∏à‡∏¥‡∏ï‡πÉ‡∏à‡∏Ç‡∏≠‡∏á‡∏ó‡πà‡∏≤‡∏ô"
              </p>
              <button onClick={() => location.reload()} className="bg-[#8B2222] text-[#E8D5B5] px-24 py-10 rounded-full font-bold uppercase tracking-[0.5em] text-[14px] shadow-2xl active:scale-95 transition-all border-2 border-[#C5A059]">
                ‡∏Å‡∏•‡∏±‡∏ö‡∏™‡∏π‡πà‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å
              </button>
            </div>
          )}

          {/* NAV DOCK */}
          {screen !== 'admin' && screen !== 'success' && (
            <div className="fixed bottom-14 left-1/2 -translate-x-1/2 w-[85%] z-40 transition-all duration-700" id="nav-dock">
              <div className="glass-premium rounded-full px-12 py-8 flex justify-between items-center shadow-[0_50px_100px_-20px_rgba(139,34,34,0.5)] border-4 border-white/50 dark:border-[#C5A059]/30">
                <button onClick={() => setScreen('home')} className={`active:scale-90 transition-transform ${screen === 'home' ? 'text-[#8B2222] dark:text-[#C5A059]' : 'text-stone-300'}`}><Home fontSize="large"/></button>
                <button onClick={() => setScreen('checkout')} className={`active:scale-90 transition-transform ${screen === 'checkout' ? 'text-[#8B2222] dark:text-[#C5A059]' : 'text-stone-300'}`}><ShoppingBag fontSize="large"/></button>
                <button onClick={() => isAdminLoggedIn ? setScreen('admin') : setShowLoginModal(true)} className="text-stone-300 active:scale-90 transition-transform"><AdminPanelSettings fontSize="large"/></button>
                
                {totalAmount > 0 && screen === 'home' && (
                  <div className="absolute -top-32 left-0 right-0 animate-in slide-in-from-bottom-5 duration-700">
                    <button onClick={() => setScreen('checkout')} className="w-full bg-stone-900 dark:bg-[#C5A059] text-[#E8D5B5] dark:text-stone-900 py-8 rounded-full text-[14px] font-bold uppercase tracking-[0.5em] shadow-2xl flex items-center justify-center gap-8 border-4 border-[#C5A059] btn-glow">
                      <span className="font-logo text-4xl">‡∏ñ‡∏ß‡∏≤‡∏¢‡∏ö‡∏∏‡∏ç</span>
                      <span className="bg-[#8B2222] text-white px-6 py-2 rounded-full font-sans text-xl">‡∏ø{totalAmount}</span>
                    </button>
                  </div>
                )}
              </div>
            </div>
          )}

          {/* ADMIN LOGIN MODAL */}
          {showLoginModal && (
            <div className="fixed inset-0 z-[100] flex items-center justify-center p-8 backdrop-blur-3xl bg-black/60 animate-in zoom-in duration-300">
              <div className="glass-premium w-full max-w-sm p-12 rounded-[4rem] text-center shadow-2xl border-[3px] border-[#C5A059]">
                <LockPerson className="text-[#8B2222] text-6xl mb-8" style={{ fontSize: 64 }} />
                <h3 className="text-4xl font-logo font-bold mb-4 text-[#8B2222] dark:text-[#C5A059]">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô</h3>
                <input type="password" value={adminPw} onChange={e=>setAdminPw(e.target.value)} placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢" className="w-full bg-stone-100 dark:bg-stone-800 border-none rounded-3xl py-6 text-center text-4xl tracking-[0.6em] mb-8 focus:ring-4 focus:ring-[#8B2222]/20 font-bold outline-none" />
                <div className="flex gap-4">
                  <button onClick={() => setShowLoginModal(false)} className="flex-1 py-5 text-sm font-bold text-stone-400">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                  <button onClick={handleAdminLogin} className="flex-1 bg-[#8B2222] text-white py-5 rounded-3xl font-bold shadow-xl">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
                </div>
                {loginError && <p className="text-red-500 text-[10px] mt-6 font-bold animate-bounce uppercase">Access Denied</p>}
              </div>
            </div>
          )}

          {/* ADD PRODUCT MODAL */}
          {showAddProduct && (
            <div className="fixed inset-0 z-[100] flex items-center justify-center p-8 backdrop-blur-3xl bg-black/60 animate-in fade-in duration-300">
              <div className="glass-premium w-full max-w-sm p-10 rounded-[4rem] shadow-2xl border-4 border-[#C5A059]">
                <div className="flex justify-between items-center mb-8">
                  <h3 className="text-3xl font-logo font-bold text-[#8B2222]">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà</h3>
                  <button onClick={()=>setShowAddProduct(false)}><Close/></button>
                </div>
                <form onSubmit={handleAddProduct} className="space-y-6">
                  <input name="pname" required placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤" className="w-full bg-stone-50 dark:bg-stone-800 border-2 border-stone-200 rounded-2xl p-5" />
                  <div className="flex gap-4">
                    <input name="pprice" type="number" required placeholder="‡∏£‡∏≤‡∏Ñ‡∏≤" className="w-full bg-stone-50 dark:bg-stone-800 border-2 border-stone-200 rounded-2xl p-5" />
                    <input name="pstock" type="number" required placeholder="‡∏™‡∏ï‡πá‡∏≠‡∏Å" className="w-full bg-stone-50 dark:bg-stone-800 border-2 border-stone-200 rounded-2xl p-5" />
                  </div>
                  <input name="pimg" required placeholder="Google Drive Image ID" className="w-full bg-stone-50 dark:bg-stone-800 border-2 border-stone-200 rounded-2xl p-5" />
                  <div className="bg-blue-50 p-4 rounded-2xl flex items-start gap-3">
                    <Info className="text-blue-500" fontSize="small"/>
                    <p className="text-[10px] text-blue-600 leading-tight italic">‡πÉ‡∏ä‡πâ Image ID ‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏Å‡∏î Share ‡∏£‡∏π‡∏õ‡πÉ‡∏ô Google Drive ‡πÅ‡∏•‡πâ‡∏ß Copy ID ‡πÉ‡∏ô‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏°‡∏≤‡∏ß‡∏≤‡∏á</p>
                  </div>
                  <button type="submit" className="w-full bg-[#8B2222] text-white py-6 rounded-full font-bold uppercase shadow-xl">Confirm & Add</button>
                </form>
              </div>
            </div>
          )}

          {/* GLOBAL LOADING */}
          {isLoading && (
            <div className="fixed inset-0 z-[110] bg-white/95 dark:bg-[#0F0A0A]/95 backdrop-blur-3xl flex flex-col items-center justify-center text-center transition-all">
              <div className="size-40 border-[8px] border-stone-200 dark:border-white/10 border-t-[#8B2222] dark:border-t-[#C5A059] rounded-full animate-spin"></div>
              <p className="mt-16 font-logo italic text-[#8B2222] dark:text-[#C5A059] tracking-[0.3em] animate-pulse text-6xl">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ô‡πâ‡∏≠‡∏°‡∏ñ‡∏ß‡∏≤‡∏¢‡πÄ‡∏à‡∏ï‡∏ô‡∏≤...</p>
            </div>
          )}

          {/* TOAST */}
          <div className={`toast glass-premium px-8 py-4 rounded-full text-sm font-bold shadow-2xl border-2 border-[#C5A059] text-[#8B2222] ${toast.show ? 'toast-active' : ''}`}>
            {toast.msg}
          </div>

        </div>
      </div>
      
      <style>{`
        @import url('https://fonts.googleapis.com/css2?family=Charm:wght@400;700&family=Noto+Serif+Thai:wght@400;700&family=Inter:wght@300;400;500;700&family=Noto+Sans+Thai:wght@300;400;500;700&display=swap');
        .font-logo { font-family: 'Charm', serif; }
        .glass-premium {
          background: rgba(255, 255, 255, 0.9);
          backdrop-filter: blur(20px);
          -webkit-backdrop-filter: blur(20px);
        }
        .dark .glass-premium {
          background: rgba(26, 20, 20, 0.95);
        }
        .silk-texture {
          background-image: url('https://www.transparenttextures.com/patterns/natural-paper.png');
          background-attachment: fixed;
        }
        .shimmer {
          background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
          background-size: 200% 100%;
          animation: shimmer 3s infinite linear;
        }
        @keyframes shimmer {
          0% { background-position: -200% 0; }
          100% { background-position: 200% 0; }
        }
        .animate-pop { animation: pop 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        @keyframes pop {
          0% { transform: scale(0.8); opacity: 0; }
          100% { transform: scale(1); opacity: 1; }
        }
        .toast {
          position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%) translateY(100px);
          opacity: 0; transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275); z-index: 1000;
        }
        .toast-active { transform: translateX(-50%) translateY(0); opacity: 1; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
      `}</style>
    </div>
  );
};

export default App;
